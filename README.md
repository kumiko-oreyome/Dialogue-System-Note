# Dialogue System Note


## 對話系統
能夠和使用者利用對話(自然語言的方式)進行交互的系統,
像是智慧音箱,或是chatbot,智慧型個人助理都算是對話系統。

對話系統的分類依照功能分類主要有以下兩種,這也是設計對話系統首先要考慮的。

## 任務導向(task oriented)
任務導向的對話系統的目的主要是為了滿足使用者一個特定的目的,像是訂車票,查詢天氣等等

通常一個對話系統上面會有很多服務,如何區分使用者需要哪些服務和確定該服務上面所需要的資訊是在設計任務導向對話系統最重要議題。

像是設計一個電影院的對話系統,可能的服務有有查詢電影時段,訂票,查詢電影時段所需要的資訊為電影名稱,日期等等,訂票有使用者資訊,位置數量,電影名稱和時間等等


任務導向的對話系統根據系統如何建構分為

### Pipeline方法
對話系統從使用者說話到回覆,會經過以下五個步驟
![](https://i.imgur.com/dxD63ut.png)
- #### ASR　　
    語音轉文字
- #### NLU　自然語意理解
    這部分的功能是為了理解使用者所說的話和獲取對話中相關的資訊。在任務導向的對話系統中常見的概念是slot和intent。
    以下以這一句話"想要訂明天早上的與神同行2的票"
    - intent
        表示使用者所需要的服務,以這個例子來說intent是訂票,對話系統有甚麼intent通常是建構系統時就定義好的。
    - slot
        表示對話中能夠幫助完成任務的資訊,以這個例子來說是
         (1)電影名稱-->與神同行2 (2)時間-->明天早上
         slot通常是和intent相關,slot類別也是先定義好的。
         (slot類別就是電影名稱和時間這兩個東西)

    所以在任務導向的對話系統裡面自然語言理解就是要判斷當使用者說一句話的時候intent是甚麼和相對應的slot需要填入甚麼值。
    
    intent偵測常用的方法,各種分類器像是NN,SVM等等
    slot偵測常用的方法,sequence labeling的方法像是CRF
    
- #### 對話管理(Dialugue Management)
    因為使用者說的前一句話會影響到後面那一句話系統的解讀,所以需要對話管理來記錄對話當前的狀態(context)。
    另外對話管理也必須要知道在當前state使用者說完後之後,系統要觸發甚麼操作,像是要查詢資料庫
    
    例如
    User:嗨！我想要知道台北的天氣狀況。（狀態：詢問天氣但缺乏資訊（時間）的狀態）
    Bot :請問是甚麼時候呢？
    User:明天　（狀態：詢問天氣狀態資訊齊全）
    
    這個時候使用者說明天代表需要知道台北明天的天氣狀況,當前狀態為詢問天氣狀態資訊齊全的狀態。
    
    常見的方法有
    - FSM(有限狀態機)
    　　將對話的狀態表示成一個有限狀態機的圖,圖上的node代表對話狀態,edge代表如何轉移。簡單來說就是rule based。
    　　　![](https://i.imgur.com/ouBoy21.png)
      - 優點
          簡單好用
      - 缺點
          不容易擴展和修改
    - Slot filling 
        通常會先定義需要填的slot,對話狀態就是當前填了哪些slot和沒有填哪些slot,缺甚麼slot系統就詢問使用者。
        ![](https://i.imgur.com/Dtzt84e.png)
        像是以上的圖為訂火車票的slot集合,當前狀態使用者已經提供了目的地以外的所有資訊,現在系統可以問使用者"請問您的目地的在哪？"
        - 優點
            靈活簡單
            設計對話時不需要考慮順序
        - 缺點
            沒有考慮到slot之間的層次,例如自動點餐系統要先知道主餐才能詢問附餐的資訊
    - Tree based Slot filling
        有把slot的層次關係考慮進去,設計的時候會更複雜
        ![](https://i.imgur.com/UNb0rvJ.png)
    - 話題的打斷和恢復
        以訂火車票的例子來說,如果使用者訂票到一半的時候詢問天氣,這時候偵測到另外一種服務(intent),那麼當前的服務的對話就必須中斷進入到詢問天氣的state,這個時候需要有一套機制去紀錄和恢復當前的state。
        這部分最簡單的方法可以使用stack
        ![](https://i.imgur.com/FCil9Tt.png)
        
    - 對話策略(Dialogue policy)
        在任務導向的對話系統內,除了回使用者話以外,有的時候必須要到資料庫查資料或其他操作,目的是確認當前的action。
        這部分可以用規則或者強化學習。
        
- #### 自然语言生成(NLG)
    產生回覆使用者的話語,通常會先建立一個模板,然後結合slot 和action將模板變成最終回覆使用者的話語。
    另外這部分也可以利用深度學習的seq2seq,和一般的seq2seq產生對話的方法不一樣的地方為,多了intent和slot以及action的資訊需要考慮。　


### End to end 方法
利用深度學習的架構把intent,slot,state,action全部都放在一個網路裡面,結合這些資訊一起產生回覆
![](https://i.imgur.com/cpZzhev.png)



## 開放式對話(閒聊)
開放式對話不需要考慮到slot intent的資訊,最主要目的就是產生好的回覆讓使用者想繼續對話。
另外開放式對話對於task oriented也是有用的,因為在實際與用戶交互時,常常會先進行一堆廢話後,才確認到用戶的意圖(之後才能用task oriented 的 framework)
分為
- ### Generation based
 產生的對話是想產生甚麼就產生甚麼,目前主流的是利用神經網路（seq2seq）產生回覆。
- ### Retrieval based
 產生回覆的對話會先存在資料庫內,然後利用模型去計算當前使用者說的話和資料庫內的哪一句話最匹配，將最匹配的那一句話經過適當的修改後回覆給使用者。
 

## 參考資料

https://www.pmcaff.com/article/index/971158746030208?from=related&pmc_param%5Bentry_id%5D=950709304427648
http://www.shuang0420.com/2018/01/03/NLP%E7%AC%94%E8%AE%B0%20-%20%E5%A4%9A%E8%BD%AE%E5%AF%B9%E8%AF%9D%E4%B9%8B%E5%AF%B9%E8%AF%9D%E7%AE%A1%E7%90%86(Dialog%20Management)/
https://www.jianshu.com/p/d713678fddfb
https://www.jianshu.com/p/5ab753ae0df8
https://yq.aliyun.com/articles/276269
http://singlecool.com/2018/04/01/DM/
https://segmentfault.com/a/1190000015285996
